<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout}">
<head>
  <title>ìˆ™ì†Œ ë“±ë¡</title>
  <link rel="stylesheet" th:href="@{/css/accommodationCreate.css}"/>

  <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=f47f9b60b05a45cfdd053b7685ec8c11&libraries=services"></script></head>
<body>

<!-- Main Content -->
<main layout:fragment="content">
  <div class="container mt-5 accommodationCreate">

    <h1 class="mb-4">ë‹¹ì‹ ì˜ ë©‹ì§„ ìˆ™ì†Œë¥¼ ë“±ë¡í•´ì£¼ì„¸ìš” ğŸ˜‰</h1>

    <form th:action="@{/host/{userId}/create(userId=${#authentication.principal.id})}" method="post" enctype="multipart/form-data">
      <!-- Step 1: ìˆ™ì†Œ ì¢…ë¥˜ ì„ íƒ -->
      <div class="mb-4">
        <h2>ìˆ™ì†Œì˜ ì¢…ë¥˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</h2>
        <div class="row">
          <div class="col-md-2 mb-3" th:each="category : ${categories}">
            <div class="card">
              <img th:src="@{'/images/essentials/' + ${category} + '.png'}" class="card-img-top categoryImg" th:alt="${category}">
              <div class="card-body">
                <div class="form-check" style="display: flex; justify-content: center">
                  <input class="form-check-input" type="radio" name="category" th:id="${category}" th:value="${category}">
                  <label class="form-check-label" th:for="${category}" th:text="${category}"></label>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Step 2: ìˆ™ì†Œ ìœ í˜• -->
      <div class="mb-4">
        <h2>ê²ŒìŠ¤íŠ¸ê°€ ì‚¬ìš©í•  ìˆ™ì†Œ ìœ í˜•</h2>
        <div class="row">
          <div class="col-md-4 mb-3" th:each="type : ${roomTypes}">
            <div class="card">
              <div class="card-body">
                <h5 class="card-title" th:text="${type}"></h5>
                <p class="card-text" th:text="${type == 'ë…ì±„' ? 'ê²ŒìŠ¤íŠ¸ê°€ ìˆ™ì†Œ ì „ì²´ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤' :
                                                               (type == 'ì›ë£¸' ? 'ê²ŒìŠ¤íŠ¸ê°€ ë¬µì„ ìˆ™ì†Œê°€ ë°©ì´ í•˜ë‚˜ì¸ íƒ€ì…ì…ë‹ˆë‹¤' :
                                                               'ê²ŒìŠ¤íŠ¸ê°€ ë¬µì„ ìˆ™ì†Œê°€ ë°©ì´ ì—¬ëŸ¬ê°œì¸ íƒ€ì…ì…ë‹ˆë‹¤')}"></p>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="roomType" th:id="${type}" th:value="${type}">
                  <label class="form-check-label" th:for="${type}" th:text="${type}"></label>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Step 3: ìˆ™ì†Œ ê¸°ë³¸ ì •ë³´ -->
      <div class="mb-4">
        <h2>ìˆ™ì†Œ ê¸°ë³¸ ì •ë³´ë¥¼ ì•Œë ¤ì£¼ì„¸ìš”</h2>
        <div class="row">
          <div class="col-md-3 mb-3" th:each="item : ${items}">
            <div class="input-group">
              <span class="input-group-text" th:text="${item}"></span>
              <input type="number" th:name="${item + 'Count'}" class="form-control" min="0" value="0">
              <button class="btn btn-outline-secondary" type="button">+</button>
              <button class="btn btn-outline-secondary" type="button">-</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Step 4: í¸ì˜ì‹œì„¤ -->
      <div class="mb-4">
        <h2>ìˆ™ì†Œ í¸ì˜ì‹œì„¤ ì •ë³´ë¥¼ ì¶”ê°€í•˜ì„¸ìš”</h2>
        <div class="row">
          <div class="col-md-3 mb-3" th:each="amenity : ${amenities}">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" th:id="${amenity}" th:value="${amenity}" name="amenities">
              <label class="form-check-label" th:for="${amenity}">
                <img th:src="@{'/images/essentials/' + ${amenity} + '.png'}" th:alt="${amenity}" class="me-2" style="width: 24px; height: 24px;">
                <span th:text="${amenity}"></span>
              </label>
            </div>
          </div>
        </div>
      </div>

      <!-- Step 5: ì‚¬ì§„ ì—…ë¡œë“œ -->
      <div class="mb-4">
        <h2>ì‚¬ì§„ì„ ë„£ì–´ì£¼ì„¸ìš”</h2>
        <div class="mb-3">
          <label for="mainImage" class="form-label">ë©”ì¸ ì´ë¯¸ì§€</label>
          <input class="form-control" type="file" id="mainImage" name="mainImageUrl" required>
        </div>
        <div class="mb-3">
          <label for="subImages" class="form-label">ì¶”ê°€ ì´ë¯¸ì§€ë“¤</label>
          <input class="form-control" type="file" id="subImages" name="subImagesUrls" multiple required>
        </div>
      </div>

      <!-- Step 6: ìˆ™ì†Œ ì •ë³´ ì…ë ¥ -->
      <div class="mb-4">
        <h2>ìˆ™ì†Œì˜ ì •ë³´ë“¤ì„ ì…ë ¥í•´ì£¼ì„¸ìš”</h2>
        <div class="mb-3">
          <input type="text" class="form-control" name="title" placeholder="ìˆ™ì†Œ ì´ë¦„">
        </div>
        <div class="mb-3">
          <input type="number" class="form-control" name="price" min="0" step="1000" placeholder="ìˆ™ì†Œ ê°€ê²©(1ë°• ê¸°ì¤€)">
        </div>
        <div class="mb-3">
          <input type="tel" class="form-control" name="contactNum" placeholder="ìˆ™ì†Œ ëŒ€í‘œ ì „í™”ë²ˆí˜¸">
        </div>
        <div class="mb-3">
          <textarea class="form-control" name="description" rows="3" placeholder="ìˆ™ì†Œ ì†Œê°œ"></textarea>
        </div>
      </div>

      <!-- Step 7: ìœ„ì¹˜ ì •ë³´ -->
      <div class="mb-4">
        <h2>ìˆ™ì†Œì˜ ìœ„ì¹˜ë¥¼ ì•Œë ¤ì£¼ì„¸ìš”</h2>
        <div id="map" style="width:100%;height:400px;"></div>
        <div id="clickLatlng" class="mt-3"></div> <!-- í´ë¦­í•œ ìœ„ì¹˜ì˜ ì£¼ì†Œë¥¼ í‘œì‹œí•  ì˜ì—­ ì¶”ê°€ -->
        <div class="mt-3">
          <select id="locationSelect" name="sido" class="form-select mb-2">
            <option value="">ì‹œÂ·ë„ ì„ íƒ</option>
            <option th:each="sido : ${sido}" th:value="${sido}" th:text="${sido}"></option>
          </select>
          <input type="text" class="form-control mb-2" name="sigugun" placeholder="ì‹œÂ·êµ¬Â·êµ°">
          <input type="text" class="form-control mb-2" name="gueup" placeholder="êµ¬Â·ì(í•´ë‹¹í•˜ëŠ” ê²½ìš°ë§Œ)">
          <input type="text" class="form-control mb-2" name="road" placeholder="ë„ë¡œëª… ì£¼ì†Œ">
          <input type="text" class="form-control mb-2" name="detailAddress" placeholder="ìƒì„¸ì£¼ì†Œ">
        </div>
      </div>

      <button type="submit" class="btn btn-primary">ë“±ë¡í•˜ê¸°</button>
    </form>

  </div>
  <script type="text/javascript">

    var mapContainer = document.getElementById('map'),
        mapOption = {
          center: new kakao.maps.LatLng(33.450701, 126.570667), // ê¸°ë³¸ ìœ„ì¹˜ ì„¤ì •
          level: 3 // ì¤Œ ë ˆë²¨ ì„¤ì •
        };

    var map = new kakao.maps.Map(mapContainer, mapOption);

    var marker = new kakao.maps.Marker({
      position: map.getCenter()
    });
    marker.setMap(map);

    var geocoder = new kakao.maps.services.Geocoder();

    kakao.maps.event.addListener(map, 'click', function(mouseEvent) {
      var latlng = mouseEvent.latLng;

      // ë§ˆì»¤ ìœ„ì¹˜ ì´ë™
      marker.setPosition(latlng);

      // ì¢Œí‘œë¥¼ ì£¼ì†Œë¡œ ë³€í™˜
      geocoder.coord2Address(latlng.getLng(), latlng.getLat(), function(result, status) {
        if (status === kakao.maps.services.Status.OK) {
          var message = result[0].road_address ? result[0].road_address.address_name : result[0].address.address_name;
          var resultDiv = document.getElementById('clickLatlng');
          resultDiv.innerText = message;

          const addressParts = message.split(' ');
          const select = document.querySelector('select[name="sido"]');
          const sigugun = document.querySelector('input[name="sigugun"]');
          const gueup = document.querySelector('input[name="gueup"]');
          const road = document.querySelector('input[name="road"]');

          // í•„ë“œ ì´ˆê¸°í™”
          select.options[0].selected = true;
          sigugun.value = "";
          gueup.value = "";
          road.value = "";

          for (let i = 0; i < addressParts.length; i++) {
            if (i == 0) {
              const option = document.querySelector('option[value="' + addressParts[i] + '"]');
              option.selected = true;
            } else if (i == 1) {
              sigugun.value = addressParts[i];
            } else if ('êµ¬ì'.includes(addressParts[i].charAt(addressParts[i].length - 1))) {
              gueup.value = addressParts[i];
            } else {
              road.value += addressParts[i] + " ";
            }
          }
        }
      });
    });

    // ì‹œë„ ì„ íƒì‹œ í•´ë‹¹ ì‹œë„ì˜ ì‹œ(ë„)ì²­ìœ¼ë¡œ ì´ë™
    document.getElementById('locationSelect').addEventListener('change', function() {

      var locations = {
        'ì„œìš¸íŠ¹ë³„ì‹œ': { lat: 37.5665, lng: 126.9780 }, // ì„œìš¸íŠ¹ë³„ì‹œì²­
        'ë¶€ì‚°ê´‘ì—­ì‹œ': { lat: 35.1796, lng: 129.0756 }, // ë¶€ì‚°ê´‘ì—­ì‹œì²­
        'ëŒ€êµ¬ê´‘ì—­ì‹œ': { lat: 35.8714, lng: 128.6014 }, // ëŒ€êµ¬ê´‘ì—­ì‹œì²­
        'ì¸ì²œê´‘ì—­ì‹œ': { lat: 37.4563, lng: 126.7052 }, // ì¸ì²œê´‘ì—­ì‹œì²­
        'ê´‘ì£¼ê´‘ì—­ì‹œ': { lat: 35.1595, lng: 126.8526 }, // ê´‘ì£¼ê´‘ì—­ì‹œì²­
        'ëŒ€ì „ê´‘ì—­ì‹œ': { lat: 36.3504, lng: 127.3845 }, // ëŒ€ì „ê´‘ì—­ì‹œì²­
        'ìš¸ì‚°ê´‘ì—­ì‹œ': { lat: 35.5396, lng: 129.3115 }, // ìš¸ì‚°ê´‘ì—­ì‹œì²­
        'ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ': { lat: 36.4800, lng: 127.2890 }, // ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œì²­
        'ê²½ê¸°ë„': { lat: 37.2751, lng: 127.0095 }, // ê²½ê¸°ë„ì²­ (ìˆ˜ì›)
        'ê°•ì›íŠ¹ë³„ìì¹˜ë„': { lat: 37.8228, lng: 128.1555 }, // ê°•ì›ë„ì²­ (ì¶˜ì²œ)
        'ì¶©ì²­ë¶ë„': { lat: 36.6359, lng: 127.4914 }, // ì¶©ì²­ë¶ë„ì²­ (ì²­ì£¼)
        'ì¶©ì²­ë‚¨ë„': { lat: 36.6588, lng: 126.6728 }, // ì¶©ì²­ë‚¨ë„ì²­ (ë‚´í¬ì‹ ë„ì‹œ)
        'ì „ë¼ë¶ë„': { lat: 35.8213, lng: 127.1480 }, // ì „ë¼ë¶ë„ì²­ (ì „ì£¼)
        'ì „ë¼ë‚¨ë„': { lat: 34.8161, lng: 126.4629 }, // ì „ë¼ë‚¨ë„ì²­ (ë¬´ì•ˆ)
        'ê²½ìƒë¶ë„': { lat: 36.5759, lng: 128.5057 }, // ê²½ìƒë¶ë„ì²­ (ì•ˆë™)
        'ê²½ìƒë‚¨ë„': { lat: 35.4606, lng: 128.2132 }, // ê²½ìƒë‚¨ë„ì²­ (ì°½ì›)
        'ì œì£¼íŠ¹ë³„ìì¹˜ë„': { lat: 33.4996, lng: 126.5312 } // ì œì£¼íŠ¹ë³„ìì¹˜ë„ì²­ (ì œì£¼)
      };

      var selectedLocation = this.value;

      if (selectedLocation && locations[selectedLocation]) {
        var latLng = new kakao.maps.LatLng(locations[selectedLocation].lat, locations[selectedLocation].lng);
        map.setCenter(latLng);

        // Optionally, you can add a marker to the selected location
        var marker = new kakao.maps.Marker({
          position: latLng
        });
        marker.setMap(map);
      }
    });
  </script>
</main>

</body>
</html>
